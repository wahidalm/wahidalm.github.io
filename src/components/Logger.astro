<!-- invisible-->
<script define:vars={{ SUPA_URL: 'https://tllrpbryxtrnpgruzgum.supabase.co', SUPA_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRsbHJwYnJ5eHRybnBncnV6Z3VtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNzMyNDYsImV4cCI6MjA4MDk0OTI0Nn0._02eH5VMlH9rRUTn_bJoC-aNg-TU10XreK377ofmFag', IP_KEY: 'e50c6fe7f2c760aa7666bf69bfd97a21' }}>
  // 1. IP
  const ipRes = await fetch('https://api.ipify.org?format=json');
  const { ip } = await ipRes.json();

  // 2. (country, city)
  const geoRes = await fetch(`https://api.ipapi.com/api/${ip}?access_key=${IP_KEY}&fields=country_name,city`);
  const geo = await geoRes.json();

  // 3. insert row (anon key is safe client-side for inserts)
  await fetch(`${SUPA_URL}/rest/v1/visitors`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'apikey': SUPA_KEY,
      'Authorization': `Bearer ${SUPA_KEY}`
    },
    body: JSON.stringify({
      ip: ip,
      country: geo.country_name,
      city: geo.city,
      visited_at: new Date().toISOString()
    })
  });
</script>