---
const SUPA_URL = 'https://tllrpbryxtrnpgruzgum.supabase.co';   
const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRsbHJwYnJ5eHRybnBncnV6Z3VtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNzMyNDYsImV4cCI6MjA4MDk0OTI0Nn0._02eH5VMlH9rRUTn_bJoC-aNg-TU10XreK377ofmFag';
                           

const res = await fetch(
  `${SUPA_URL}/rest/v1/visitors?select=*&order=visited_at.desc`,
  { headers: { apikey: SUPA_KEY } }
);

if (!res.ok) {
  throw new Error(`Supabase error ${res.status}: ${await res.text()}`);
}

const body = await res.json();
if (!Array.isArray(body)) {
  throw new Error(`Unexpected response: ${JSON.stringify(body)}`);
}

const data = body;
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Visitor Log</title>
    <style>
      body{font-family:system-ui;background:#111;color:#eee;padding:2rem}
      table{width:100%;border-collapse:collapse;margin-top:1rem}
      th,td{padding:.5rem 1rem;border:1px solid #333;text-align:left}
      th{background:#222}
      .center{display:grid;place-items:center;min-height:100vh}
    </style>
  </head>
  <body>
    <div class="center">
      <h1>Visitor Log ({data.length})</h1>
      <table>
        <thead>
          <tr><th>IP</th><th>Country</th><th>City</th><th>Time (UTC)</th></tr>
        </thead>
        <tbody>
          {data.map((v) => (
            <tr>
              <td>{v.ip}</td>
              <td>{v.country}</td>
              <td>{v.city}</td>
              <td>{new Date(v.visited_at).toLocaleString()}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </body>
</html>